

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Decoding Procedures &mdash; oneAPI Specification 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../_static/favicons.png"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Encoding Procedures" href="VPL_prg_encoding.html" />
    <link rel="prev" title="Frame and Fields" href="VPL_prg_frame.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://oneapi.com" class="icon icon-home"> oneAPI Specification
          

          
            
            <img src="../../../../_static/oneAPI-rgb-rev-100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../library-interop.html">Library Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../elements.html">oneAPI Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dpcpp/source/index.html">DPC++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDPL/source/index.html">oneDPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDNN/source/index.html">oneDNN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneCCL/source/index.html">oneCCL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../l0/source/index.html">Level Zero</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDAL/source/index.html">oneDAL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneTBB/source/nested-index.html">oneTBB</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">oneVPL</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../architecture/index.html">Architecture</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Programming Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_stc.html">Status Codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_session.html">oneVPL Session</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_frame.html">Frame and Fields</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Decoding Procedures</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bitstream-repositioning">Bitstream Repositioning</a></li>
<li class="toctree-l4"><a class="reference internal" href="#broken-streams-handling">Broken Streams Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vp8-specific-details">VP8 Specific Details</a></li>
<li class="toctree-l4"><a class="reference internal" href="#jpeg">JPEG</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multi-view-video-decoding">Multi-view Video Decoding</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_encoding.html">Encoding Procedures</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_vpp.html">Video Processing Procedures</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_transcoding.html">Transcoding Procedures</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_hw.html">Hardware Acceleration</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_mem.html">Memory Allocation and External Allocators</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPL_prg_err.html">Hardware Device Error Handling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../VPL_summary.html">Mandatory APIs and Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../API_ref/VPL_api_ref.html">oneVPL API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Versioning.html">oneVPL API Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendix/index.html">Appendices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../VPL_acronyms.html">Glossary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneMKL/source/index.html">oneMKL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../versions.html">HTML and PDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notices.html">Legal Notices and Disclaimers</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">oneAPI Specification</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">oneAPI Specification</a> &raquo;</li>
        
          
          <li><a href="../index.html">oneVPL</a> </li>
          
        
          
        
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/oneapi-src/oneapi-spec/blob/master/source/elements/oneVPL/source/programming_guide/VPL_prg_decoding.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="decoding-procedures">
<span id="decoding-proc"></span><h1>Decoding Procedures<a class="headerlink" href="#decoding-procedures" title="Permalink to this headline">¶</a></h1>
<p>The following pseudo code shows the decoding procedure:</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">MFXVideoDECODE_DecodeHeader</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">bitstream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">init_param</span><span class="p">);</span>
<span class="n">MFXVideoDECODE_QueryIOSurf</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">init_param</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">request</span><span class="p">);</span>
<span class="n">allocate_pool_of_frame_surfaces</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">NumFrameSuggested</span><span class="p">);</span>
<span class="n">MFXVideoDECODE_Init</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">init_param</span><span class="p">);</span>
<span class="n">sts</span><span class="o">=</span><span class="n">MFX_ERR_MORE_DATA</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">sts</span><span class="o">==</span><span class="n">MFX_ERR_MORE_DATA</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">end_of_stream</span><span class="p">())</span>
      <span class="n">append_more_bitstream</span><span class="p">(</span><span class="n">bitstream</span><span class="p">);</span>
   <span class="n">find_unlocked_surface_from_the_pool</span><span class="p">(</span><span class="o">&amp;</span><span class="n">work</span><span class="p">);</span>
   <span class="n">bits</span><span class="o">=</span><span class="p">(</span><span class="n">end_of_stream</span><span class="p">())</span><span class="o">?</span><span class="nb">NULL</span><span class="o">:</span><span class="n">bitstream</span><span class="p">;</span>
   <span class="n">sts</span><span class="o">=</span><span class="n">MFXVideoDECODE_DecodeFrameAsync</span><span class="p">(</span><span class="n">session</span><span class="p">,</span><span class="n">bits</span><span class="p">,</span><span class="n">work</span><span class="p">,</span><span class="o">&amp;</span><span class="n">disp</span><span class="p">,</span><span class="o">&amp;</span><span class="n">syncp</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">sts</span><span class="o">==</span><span class="n">MFX_ERR_MORE_SURFACE</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">end_of_stream</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">sts</span><span class="o">==</span><span class="n">MFX_ERR_MORE_DATA</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">sts</span><span class="o">==</span><span class="n">MFX_ERR_REALLOC_SURFACE</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">MFXVideoDECODE_GetVideoParam</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">param</span><span class="p">);</span>
      <span class="n">realloc_surface</span><span class="p">(</span><span class="n">work</span><span class="p">,</span> <span class="n">param</span><span class="p">.</span><span class="n">mfx</span><span class="p">.</span><span class="n">FrameInfo</span><span class="p">);</span>
      <span class="k">continue</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="c1">// skipped other error handling</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">sts</span><span class="o">==</span><span class="n">MFX_ERR_NONE</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">MFXVideoCORE_SyncOperation</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">syncp</span><span class="p">,</span> <span class="n">INFINITE</span><span class="p">);</span>
      <span class="n">do_something_with_decoded_frame</span><span class="p">(</span><span class="n">disp</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
<span class="n">MFXVideoDECODE_Close</span><span class="p">(</span><span class="n">session</span><span class="p">);</span>
<span class="n">free_pool_of_frame_surfaces</span><span class="p">();</span>
</pre></div>
</td></tr></table></div>
<p>Note the following key points about the example:</p>
<ul>
<li><p>The application can use the <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv427MFXVideoDECODE_DecodeHeader10mfxSessionP12mfxBitstreamP13mfxVideoParam" title="MFXVideoDECODE_DecodeHeader"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_DecodeHeader()</span></code></a> function
to retrieve decoding initialization parameters from the bitstream. This step
is optional if the data is retrievable from other sources such as an
audio/video splitter.</p></li>
<li><p>The application can use the <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv426MFXVideoDECODE_QueryIOSurf10mfxSessionP13mfxVideoParamP20mfxFrameAllocRequest" title="MFXVideoDECODE_QueryIOSurf"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_QueryIOSurf()</span></code></a> function to
obtain the number of working frame surfaces required to reorder output frames.
This step is required if the application is responsible for memory allocation.
Use of this function is not required if oneVPL is responsible for memory
allocation.</p></li>
<li><p>The application calls the <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv431MFXVideoDECODE_DecodeFrameAsync10mfxSessionP12mfxBitstreamP16mfxFrameSurface1PP16mfxFrameSurface1P12mfxSyncPoint" title="MFXVideoDECODE_DecodeFrameAsync"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_DecodeFrameAsync()</span></code></a> function
for a decoding operation with the bitstream buffer (bits) and an unlocked
working frame surface (work) as input parameters.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Starting with oneVPL API version 2.0, the application can provide NULL
as the working frame surface that leads to internal memory
allocation.</p>
</div>
</li>
<li><p>If decoding output is not available, the function returns a status code
requesting additional bitstream input or working frame surfaces as follows:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../API_ref/VPL_enums.html#_CPPv4N9mfxStatus17MFX_ERR_MORE_DATAE" title="mfxStatus::MFX_ERR_MORE_DATA"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">mfxStatus::MFX_ERR_MORE_DATA</span></code></a>: The function needs additional
bitstream input. The existing buffer contains less than a frame’s worth of
bitstream data.</p></li>
<li><p><a class="reference internal" href="../API_ref/VPL_enums.html#_CPPv4N9mfxStatus20MFX_ERR_MORE_SURFACEE" title="mfxStatus::MFX_ERR_MORE_SURFACE"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">mfxStatus::MFX_ERR_MORE_SURFACE</span></code></a>: The function needs one
more frame surface to produce any output.</p></li>
<li><p><a class="reference internal" href="../API_ref/VPL_enums.html#_CPPv4N9mfxStatus23MFX_ERR_REALLOC_SURFACEE" title="mfxStatus::MFX_ERR_REALLOC_SURFACE"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">mfxStatus::MFX_ERR_REALLOC_SURFACE</span></code></a>: Dynamic resolution
change case - the function needs a bigger working frame surface (work).</p></li>
</ul>
</li>
<li><p>Upon successful decoding, the <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv431MFXVideoDECODE_DecodeFrameAsync10mfxSessionP12mfxBitstreamP16mfxFrameSurface1PP16mfxFrameSurface1P12mfxSyncPoint" title="MFXVideoDECODE_DecodeFrameAsync"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_DecodeFrameAsync()</span></code></a>
function returns <a class="reference internal" href="../API_ref/VPL_enums.html#_CPPv4N9mfxStatus12MFX_ERR_NONEE" title="mfxStatus::MFX_ERR_NONE"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">mfxStatus::MFX_ERR_NONE</span></code></a>. However, the
decoded frame data (identified by the surface_out pointer) is not yet available
because the <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv431MFXVideoDECODE_DecodeFrameAsync10mfxSessionP12mfxBitstreamP16mfxFrameSurface1PP16mfxFrameSurface1P12mfxSyncPoint" title="MFXVideoDECODE_DecodeFrameAsync"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_DecodeFrameAsync()</span></code></a> function is asynchronous.
The application must use the <a class="reference internal" href="../API_ref/VPL_func_vidcore.html#_CPPv426MFXVideoCORE_SyncOperation10mfxSession12mfxSyncPoint6mfxU32" title="MFXVideoCORE_SyncOperation"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoCORE_SyncOperation()</span></code></a> or
<a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv424mfxFrameSurfaceInterface" title="mfxFrameSurfaceInterface"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxFrameSurfaceInterface</span></code></a> interface to synchronize the decoding
operation before retrieving the decoded frame data.</p></li>
<li><p>At the end of the bitstream, the application continuously calls the
<a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv431MFXVideoDECODE_DecodeFrameAsync10mfxSessionP12mfxBitstreamP16mfxFrameSurface1PP16mfxFrameSurface1P12mfxSyncPoint" title="MFXVideoDECODE_DecodeFrameAsync"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_DecodeFrameAsync()</span></code></a> function with a NULL bitstream
pointer to drain any remaining frames cached within the oneVPL decoder until the
function returns <a class="reference internal" href="../API_ref/VPL_enums.html#_CPPv4N9mfxStatus17MFX_ERR_MORE_DATAE" title="mfxStatus::MFX_ERR_MORE_DATA"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">mfxStatus::MFX_ERR_MORE_DATA</span></code></a>.</p></li>
</ul>
<p>The following pseudo code shows the simplified decoding procedure:</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">sts</span><span class="o">=</span><span class="n">MFX_ERR_MORE_DATA</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">sts</span><span class="o">==</span><span class="n">MFX_ERR_MORE_DATA</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">end_of_stream</span><span class="p">())</span>
      <span class="n">append_more_bitstream</span><span class="p">(</span><span class="n">bitstream</span><span class="p">);</span>
   <span class="n">bits</span><span class="o">=</span><span class="p">(</span><span class="n">end_of_stream</span><span class="p">())</span><span class="o">?</span><span class="nb">NULL</span><span class="o">:</span><span class="n">bitstream</span><span class="p">;</span>
   <span class="n">sts</span><span class="o">=</span><span class="n">MFXVideoDECODE_DecodeFrameAsync</span><span class="p">(</span><span class="n">session</span><span class="p">,</span><span class="n">bits</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="o">&amp;</span><span class="n">disp</span><span class="p">,</span><span class="o">&amp;</span><span class="n">syncp</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">sts</span><span class="o">==</span><span class="n">MFX_ERR_MORE_SURFACE</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">end_of_stream</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">sts</span><span class="o">==</span><span class="n">MFX_ERR_MORE_DATA</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
   <span class="c1">// skipped other error handling</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">sts</span><span class="o">==</span><span class="n">MFX_ERR_NONE</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">MFXVideoCORE_SyncOperation</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">syncp</span><span class="p">,</span> <span class="n">INFINITE</span><span class="p">);</span>
      <span class="n">do_something_with_decoded_frame</span><span class="p">(</span><span class="n">disp</span><span class="p">);</span>
      <span class="n">release_surface</span><span class="p">(</span><span class="n">disp</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p id="simplified-decoding-procedure">oneVPL API version 2.0 introduces a new decoding approach. For simple use cases, when
the user wants to decode a stream and does not want to set additional
parameters, a simplified procedure for the decoder’s initialization has been
proposed. In this scenario it is possible to skip explicit stages of a
stream’s header decoding and the decoder’s initialization and instead to perform
these steps implicitly during decoding of the first frame. This change also
requires setting the additional field <a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv4N12mfxBitstream7CodecIdE" title="mfxBitstream::CodecId"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">mfxBitstream::CodecId</span></code></a> to indicate
codec type. In this mode the decoder allocates <a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv416mfxFrameSurface1" title="mfxFrameSurface1"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxFrameSurface1</span></code></a>
internally, so users should set the input surface to zero.</p>
<div class="section" id="bitstream-repositioning">
<h2>Bitstream Repositioning<a class="headerlink" href="#bitstream-repositioning" title="Permalink to this headline">¶</a></h2>
<p>The application can use the following procedure for bitstream reposition during
decoding:</p>
<ol class="arabic simple">
<li><p>Use the <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv420MFXVideoDECODE_Reset10mfxSessionP13mfxVideoParam" title="MFXVideoDECODE_Reset"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_Reset()</span></code></a> function to reset the oneVPL decoder.</p></li>
<li><p>Optional: If the application maintains a sequence header that correctly
decodes the bitstream at the new position, the application may insert the
sequence header to the bitstream buffer.</p></li>
<li><p>Append the bitstream from the new location to the bitstream buffer.</p></li>
<li><p>Resume the decoding procedure. If the sequence header is not inserted in the
previous steps, the oneVPL decoder searches for a new sequence header before
starting decoding.</p></li>
</ol>
</div>
<div class="section" id="broken-streams-handling">
<h2>Broken Streams Handling<a class="headerlink" href="#broken-streams-handling" title="Permalink to this headline">¶</a></h2>
<p>Robustness and the capability to handle a broken input stream is an important
part of the decoder.</p>
<p>First, the start code prefix (ITU-T* H.264 3.148 and ITU-T H.265 3.142) is
used to separate NAL units. Then all syntax elements in the bitstream are parsed
and verified. If any of the elements violate the specification, the input
bitstream is considered invalid and the decoder tries to re-sync (find the next
start code). Subsequent decoder behavior is dependent on which syntax element is
broken:</p>
<ul class="simple">
<li><p>SPS header is broken: return <a class="reference internal" href="../API_ref/VPL_enums.html#_CPPv4N9mfxStatus32MFX_ERR_INCOMPATIBLE_VIDEO_PARAME" title="mfxStatus::MFX_ERR_INCOMPATIBLE_VIDEO_PARAM"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">mfxStatus::MFX_ERR_INCOMPATIBLE_VIDEO_PARAM</span></code></a>
(HEVC decoder only, AVC decoder uses last valid).</p></li>
<li><p>PPS header is broken: re-sync, use last valid PPS for decoding.</p></li>
<li><p>Slice header is broken: skip this slice, re-sync.</p></li>
<li><p>Slice data is broken: corruption flags are set on output surface.</p></li>
</ul>
<p>Many streams have IDR frames with <code class="docutils literal notranslate"><span class="pre">frame_num</span> <span class="pre">!=</span> <span class="pre">0</span></code> while the specification says
that “If the current picture is an IDR picture, frame_num shall be equal to 0”
(ITU-T H.265 7.4.3).</p>
<p>VUI is also validated, but errors do not invalidate the whole SPS. The decoder
either does not use the corrupted VUI (AVC) or resets incorrect values to
default (HEVC).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some requirements are relaxed because there are many streams which
violate the strict standard but can be decoded without errors.</p>
</div>
<p>Corruption at the reference frame is spread over all inter-coded pictures that
use the reference frame for prediction. To cope with this problem you must either
periodically insert I-frames (intra-coded) or use the intra-refresh technique.
The intra-refresh technique allows recovery from corruptions within a
predefined time interval. The main point of intra-refresh is to insert a cyclic
intra-coded pattern (usually a row) of macroblocks into the inter-coded pictures,
restricting motion vectors accordingly. Intra-refresh is often used in combination
with recovery point SEI, where the <code class="docutils literal notranslate"><span class="pre">recovery_frame_cnt</span></code> is derived from the
intra-refresh interval. The recovery point SEI message is well described at
ITU-T H.264 D.2.7 and ITU-T H.265 D.2.8. If decoding starts from AU associated
with this SEI message, then the message can be used by the decoder to determine
from which picture all subsequent pictures have no errors. In comparison to IDR,
the recovery point message does not mark reference pictures as “unused for
reference”.</p>
<p>Besides validation of syntax elements and their constraints, the decoder also uses
various hints to handle broken streams:</p>
<ul class="simple">
<li><p>If there are no valid slices for the current frame, then the whole frame is skipped.</p></li>
<li><p>The slices which violate slice segment header semantics (ITU-T H.265 7.4.7.1)
are skipped. Only the <code class="docutils literal notranslate"><span class="pre">slice_temporal_mvp_enabled_flag</span></code> is checked for now.</p></li>
<li><p>Since LTR (Long Term Reference) stays at DPB until it is explicitly
cleared by IDR or MMCO, the incorrect LTR could cause long standing visual
artifacts. AVC decoder uses the following approaches to handle this:</p>
<ul>
<li><p>When there is a DPB overflow in the case of an incorrect MMCO command that
marks the reference picture as LT, the operation is rolled back.</p></li>
<li><p>An IDR frame with <code class="docutils literal notranslate"><span class="pre">frame_num</span> <span class="pre">!=</span> <span class="pre">0</span></code> can’t be LTR.</p></li>
</ul>
</li>
<li><p>If the decoder detects frame gapping, it inserts “fake”’” (marked as non-existing)
frames, updates FrameNumWrap (ITU-T H.264 8.2.4.1) for reference frames, and
applies the Sliding Window (ITU-T H.264 8.2.5.3) marking process. Fake frames
are marked as reference, but since they are marked as non-existing, they are
not used for inter-prediction.</p></li>
</ul>
</div>
<div class="section" id="vp8-specific-details">
<h2>VP8 Specific Details<a class="headerlink" href="#vp8-specific-details" title="Permalink to this headline">¶</a></h2>
<p>Unlike other oneVPL supported decoders, VP8 can accept only a complete frame as
input. The application should provide the complete frame accompanied by the
<a class="reference internal" href="../API_ref/VPL_enums.html#_CPPv428MFX_BITSTREAM_COMPLETE_FRAME" title="MFX_BITSTREAM_COMPLETE_FRAME"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">MFX_BITSTREAM_COMPLETE_FRAME</span></code></a> flag. This is the single specific
difference.</p>
</div>
<div class="section" id="jpeg">
<h2>JPEG<a class="headerlink" href="#jpeg" title="Permalink to this headline">¶</a></h2>
<p>The application can use the same decoding procedures for JPEG/motion JPEG decoding,
as shown in the following pseudo code:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// optional; retrieve initialization parameters</span>
<span class="n">MFXVideoDECODE_DecodeHeader</span><span class="p">(...);</span>
<span class="c1">// decoder initialization</span>
<span class="n">MFXVideoDECODE_Init</span><span class="p">(...);</span>
<span class="c1">// single frame/picture decoding</span>
<span class="n">MFXVideoDECODE_DecodeFrameAsync</span><span class="p">(...);</span>
<span class="n">MFXVideoCORE_SyncOperation</span><span class="p">(...);</span>
<span class="c1">// optional; retrieve meta-data</span>
<span class="n">MFXVideoDECODE_GetUserData</span><span class="p">(...);</span>
<span class="c1">// close</span>
<span class="n">MFXVideoDECODE_Close</span><span class="p">(...);</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv420MFXVideoDECODE_Query10mfxSessionP13mfxVideoParamP13mfxVideoParam" title="MFXVideoDECODE_Query"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_Query()</span></code></a> function will return
<a class="reference internal" href="../API_ref/VPL_enums.html#_CPPv4N9mfxStatus19MFX_ERR_UNSUPPORTEDE" title="mfxStatus::MFX_ERR_UNSUPPORTED"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">mfxStatus::MFX_ERR_UNSUPPORTED</span></code></a> if the input bitstream contains
unsupported features.</p>
<p>For still picture JPEG decoding, the input can be any JPEG bitstreams that
conform to the ITU-T Recommendation T.81 with an EXIF or JFIF header. For
motion JPEG decoding, the input can be any JPEG bitstreams that conform to the
ITU-T Recommendation T.81.</p>
<p>Unlike other oneVPL decoders, JPEG decoding supports three different output color
formats: <a class="reference internal" href="../VPL_acronyms.html#term-NV12"><span class="xref std std-term">NV12</span></a>, <a class="reference internal" href="../VPL_acronyms.html#term-YUY2"><span class="xref std std-term">YUY2</span></a>, and <a class="reference internal" href="../VPL_acronyms.html#term-RGB32"><span class="xref std std-term">RGB32</span></a>. This support sometimes
requires internal color conversion and more complicated initialization. The color
format of the input bitstream is described by the
<a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv4N10mfxInfoMFX16JPEGChromaFormatE" title="mfxInfoMFX::JPEGChromaFormat"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">mfxInfoMFX::JPEGChromaFormat</span></code></a> and <a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv4N10mfxInfoMFX15JPEGColorFormatE" title="mfxInfoMFX::JPEGColorFormat"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">mfxInfoMFX::JPEGColorFormat</span></code></a> fields.. The <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv427MFXVideoDECODE_DecodeHeader10mfxSessionP12mfxBitstreamP13mfxVideoParam" title="MFXVideoDECODE_DecodeHeader"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_DecodeHeader()</span></code></a> function usually fills
them in. If the JPEG bitstream does not contains color format information, the
application should provide it. Output color format is described by general oneVPL
parameters: the <a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv4N12mfxFrameInfo6FourCCE" title="mfxFrameInfo::FourCC"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">mfxFrameInfo::FourCC</span></code></a> and <a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv4N12mfxFrameInfo12ChromaFormatE" title="mfxFrameInfo::ChromaFormat"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">mfxFrameInfo::ChromaFormat</span></code></a> fields.</p>
<p>Motion JPEG supports interlaced content by compressing each field (a half-height
frame) individually. This behavior is incompatible with the rest of the oneVPL
transcoding pipeline, where oneVPL requires fields to be in odd and even lines
of the same frame surface. The decoding procedure is modified as follows:</p>
<ul class="simple">
<li><p>The application calls the <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv427MFXVideoDECODE_DecodeHeader10mfxSessionP12mfxBitstreamP13mfxVideoParam" title="MFXVideoDECODE_DecodeHeader"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_DecodeHeader()</span></code></a> function
with the first field JPEG bitstream to retrieve initialization parameters.</p></li>
<li><p>The application initializes the oneVPL JPEG decoder with the following settings:</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">PicStruct</span></code> field of the <a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv413mfxVideoParam" title="mfxVideoParam"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxVideoParam</span></code></a> structure set to the
correct interlaced type, <a class="reference internal" href="../API_ref/VPL_enums.html#_CPPv423MFX_PICSTRUCT_FIELD_TFF" title="MFX_PICSTRUCT_FIELD_TFF"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">MFX_PICSTRUCT_FIELD_TFF</span></code></a> or
<a class="reference internal" href="../API_ref/VPL_enums.html#_CPPv423MFX_PICSTRUCT_FIELD_BFF" title="MFX_PICSTRUCT_FIELD_BFF"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">MFX_PICSTRUCT_FIELD_BFF</span></code></a>, from the motion JPEG header.</p></li>
<li><p>Double the <code class="docutils literal notranslate"><span class="pre">Height</span></code> field in the <a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv413mfxVideoParam" title="mfxVideoParam"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxVideoParam</span></code></a> structure as the
value returned by the <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv427MFXVideoDECODE_DecodeHeader10mfxSessionP12mfxBitstreamP13mfxVideoParam" title="MFXVideoDECODE_DecodeHeader"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_DecodeHeader()</span></code></a> function
describes only the first field. The actual frame surface should contain both
fields.</p></li>
</ul>
</li>
<li><p>During decoding, the application sends both fields for decoding in the
same <a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv412mfxBitstream" title="mfxBitstream"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxBitstream</span></code></a>. The application should also set <a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv4N12mfxBitstream8DataFlagE" title="mfxBitstream::DataFlag"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">mfxBitstream::DataFlag</span></code></a>
to <a class="reference internal" href="../API_ref/VPL_enums.html#_CPPv428MFX_BITSTREAM_COMPLETE_FRAME" title="MFX_BITSTREAM_COMPLETE_FRAME"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">MFX_BITSTREAM_COMPLETE_FRAME</span></code></a>. oneVPL decodes both fields
and combines them into odd and even lines according to oneVPL convention.</p></li>
</ul>
<p>By default, the <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv427MFXVideoDECODE_DecodeHeader10mfxSessionP12mfxBitstreamP13mfxVideoParam" title="MFXVideoDECODE_DecodeHeader"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_DecodeHeader()</span></code></a> function returns the
<code class="docutils literal notranslate"><span class="pre">Rotation</span></code> parameter so that after rotation, the pixel at the
first row and first column is at the top left. The application can overwrite the
default rotation before calling <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv419MFXVideoDECODE_Init10mfxSessionP13mfxVideoParam" title="MFXVideoDECODE_Init"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_Init()</span></code></a>.</p>
<p>The application may specify Huffman and quantization tables during decoder
initialization by attaching <a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv421mfxExtJPEGQuantTables" title="mfxExtJPEGQuantTables"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxExtJPEGQuantTables</span></code></a> and
<a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv423mfxExtJPEGHuffmanTables" title="mfxExtJPEGHuffmanTables"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxExtJPEGHuffmanTables</span></code></a> buffers to the <a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv413mfxVideoParam" title="mfxVideoParam"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxVideoParam</span></code></a>
structure. In this case, the decoder ignores tables from bitstream and uses
the tables specified by the application. The application can also retrieve these
tables by attaching the same buffers to <a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv413mfxVideoParam" title="mfxVideoParam"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxVideoParam</span></code></a> and calling
<a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv428MFXVideoDECODE_GetVideoParam10mfxSessionP13mfxVideoParam" title="MFXVideoDECODE_GetVideoParam"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_GetVideoParam()</span></code></a> or <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv427MFXVideoDECODE_DecodeHeader10mfxSessionP12mfxBitstreamP13mfxVideoParam" title="MFXVideoDECODE_DecodeHeader"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_DecodeHeader()</span></code></a>
functions.</p>
</div>
<div class="section" id="multi-view-video-decoding">
<h2>Multi-view Video Decoding<a class="headerlink" href="#multi-view-video-decoding" title="Permalink to this headline">¶</a></h2>
<p>The oneVPL MVC decoder operates on complete MVC streams that contain all
view and temporal configurations. The application can configure the oneVPL decoder
to generate a subset at the decoding output. To do this, the application must
understand the stream structure and use the stream information to configure the
decoder for target views.</p>
<p>The decoder initialization procedure is as follows:</p>
<ol class="arabic simple">
<li><p>The application calls the <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv427MFXVideoDECODE_DecodeHeader10mfxSessionP12mfxBitstreamP13mfxVideoParam" title="MFXVideoDECODE_DecodeHeader"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_DecodeHeader()</span></code></a> function to
obtain the stream structural information. This is done in two steps:</p>
<ol class="arabic simple">
<li><p>The application calls the <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv427MFXVideoDECODE_DecodeHeader10mfxSessionP12mfxBitstreamP13mfxVideoParam" title="MFXVideoDECODE_DecodeHeader"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_DecodeHeader()</span></code></a> function
with the <a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv416mfxExtMVCSeqDesc" title="mfxExtMVCSeqDesc"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxExtMVCSeqDesc</span></code></a> structure attached to the
<a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv413mfxVideoParam" title="mfxVideoParam"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxVideoParam</span></code></a> structure. At this point, do not allocate
memory for the arrays in the <a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv416mfxExtMVCSeqDesc" title="mfxExtMVCSeqDesc"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxExtMVCSeqDesc</span></code></a> structure. Set
the <code class="docutils literal notranslate"><span class="pre">View</span></code>, <code class="docutils literal notranslate"><span class="pre">ViewId</span></code>, and <code class="docutils literal notranslate"><span class="pre">OP</span></code> pointers to NULL and set
<code class="docutils literal notranslate"><span class="pre">NumViewAlloc</span></code>, <code class="docutils literal notranslate"><span class="pre">NumViewIdAlloc</span></code>, and <code class="docutils literal notranslate"><span class="pre">NumOPAlloc</span></code> to zero. The
function parses the bitstream and returns
<a class="reference internal" href="../API_ref/VPL_enums.html#_CPPv4N9mfxStatus25MFX_ERR_NOT_ENOUGH_BUFFERE" title="mfxStatus::MFX_ERR_NOT_ENOUGH_BUFFER"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">mfxStatus::MFX_ERR_NOT_ENOUGH_BUFFER</span></code></a> with the correct
values for <code class="docutils literal notranslate"><span class="pre">NumView</span></code>, <code class="docutils literal notranslate"><span class="pre">NumViewId</span></code>, and <code class="docutils literal notranslate"><span class="pre">NumOP</span></code>. This step can be
skipped if the application is able to obtain the <code class="docutils literal notranslate"><span class="pre">NumView</span></code>, <code class="docutils literal notranslate"><span class="pre">NumViewId</span></code>,
and <code class="docutils literal notranslate"><span class="pre">NumOP</span></code> values from other sources.</p></li>
<li><p>The application allocates memory for the <code class="docutils literal notranslate"><span class="pre">View</span></code>, <code class="docutils literal notranslate"><span class="pre">ViewId</span></code>, and <code class="docutils literal notranslate"><span class="pre">OP</span></code>
arrays and calls the <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv427MFXVideoDECODE_DecodeHeader10mfxSessionP12mfxBitstreamP13mfxVideoParam" title="MFXVideoDECODE_DecodeHeader"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_DecodeHeader()</span></code></a> function again.
The function returns the MVC structural information in the allocated arrays.</p></li>
</ol>
</li>
<li><p>The application fills the <a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv420mfxExtMVCTargetViews" title="mfxExtMVCTargetViews"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxExtMVCTargetViews</span></code></a> structure to
choose the target views, based on information described in the
<a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv416mfxExtMVCSeqDesc" title="mfxExtMVCSeqDesc"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxExtMVCSeqDesc</span></code></a> structure.</p></li>
<li><p>The application initializes the oneVPL decoder using the
<a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv419MFXVideoDECODE_Init10mfxSessionP13mfxVideoParam" title="MFXVideoDECODE_Init"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_Init()</span></code></a> function. The application must attach both the
<a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv416mfxExtMVCSeqDesc" title="mfxExtMVCSeqDesc"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxExtMVCSeqDesc</span></code></a> structure and the <a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv420mfxExtMVCTargetViews" title="mfxExtMVCTargetViews"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxExtMVCTargetViews</span></code></a>
structure to the <a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv413mfxVideoParam" title="mfxVideoParam"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxVideoParam</span></code></a> structure.</p></li>
</ol>
<p>In the above steps, do not modify the values of the <a class="reference internal" href="../API_ref/VPL_structs_cross_component.html#_CPPv416mfxExtMVCSeqDesc" title="mfxExtMVCSeqDesc"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxExtMVCSeqDesc</span></code></a>
structure after the <a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv427MFXVideoDECODE_DecodeHeader10mfxSessionP12mfxBitstreamP13mfxVideoParam" title="MFXVideoDECODE_DecodeHeader"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_DecodeHeader()</span></code></a> function, as the oneVPL
decoder uses the values in the structure for internal memory allocation. Once the
application configures the oneVPL decoder, the rest of the decoding procedure remains
unchanged. As shown in the pseudo code below, the application calls the
<a class="reference internal" href="../API_ref/VPL_func_vid_decode.html#_CPPv431MFXVideoDECODE_DecodeFrameAsync10mfxSessionP12mfxBitstreamP16mfxFrameSurface1PP16mfxFrameSurface1P12mfxSyncPoint" title="MFXVideoDECODE_DecodeFrameAsync"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MFXVideoDECODE_DecodeFrameAsync()</span></code></a> function multiple times to obtain all
target views of the current frame picture, one target view at a time. The target
view is identified by the <code class="docutils literal notranslate"><span class="pre">FrameID</span></code> field of the <a class="reference internal" href="../API_ref/VPL_structs_memory.html#_CPPv412mfxFrameInfo" title="mfxFrameInfo"><code class="xref cpp cpp-struct docutils literal notranslate"><span class="pre">mfxFrameInfo</span></code></a>
structure.</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">mfxExtBuffer</span> <span class="o">*</span><span class="n">eb</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">mfxExtMVCSeqDesc</span>  <span class="n">seq_desc</span><span class="p">;</span>
<span class="n">mfxVideoParam</span> <span class="n">init_param</span><span class="p">;</span>

<span class="n">init_param</span><span class="p">.</span><span class="n">ExtParam</span><span class="o">=</span><span class="p">(</span><span class="n">mfxExtBuffer</span> <span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">eb</span><span class="p">;</span>
<span class="n">init_param</span><span class="p">.</span><span class="n">NumExtParam</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">eb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">mfxExtBuffer</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">seq_desc</span><span class="p">;</span>
<span class="n">MFXVideoDECODE_DecodeHeader</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">bitstream</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">init_param</span><span class="p">);</span>

<span class="cm">/* select views to decode */</span>
<span class="n">mfxExtMVCTargetViews</span> <span class="n">tv</span><span class="p">;</span>
<span class="n">init_param</span><span class="p">.</span><span class="n">NumExtParam</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
<span class="n">eb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">mfxExtBuffer</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">tv</span><span class="p">;</span>

<span class="cm">/* initialize decoder */</span>
<span class="n">MFXVideoDECODE_Init</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">init_param</span><span class="p">);</span>

<span class="cm">/* perform decoding */</span>
<span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
    <span class="n">MFXVideoDECODE_DecodeFrameAsync</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">bits</span><span class="p">,</span> <span class="n">work</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">disp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">syncp</span><span class="p">);</span>
    <span class="n">MFXVideoCORE_SyncOperation</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">syncp</span><span class="p">,</span> <span class="n">INFINITE</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* close decoder */</span>
<span class="n">MFXVideoDECODE_Close</span><span class="p">(</span><span class="n">session</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="VPL_prg_encoding.html" class="btn btn-neutral float-right" title="Encoding Procedures" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="VPL_prg_frame.html" class="btn btn-neutral float-left" title="Frame and Fields" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Intel Corporation

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>